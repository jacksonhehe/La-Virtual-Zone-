import{k as Y,r as l,j as e,X as D,U as O,M as V,n as F,V as H,p as X,aa as G,ab as J,x as Q,ac as W,ad as ee,ae as se}from"./index-DTVNIeXw.js";import{U as Z}from"./user-plus-BoLAMYrr.js";import{A as v}from"./alert-triangle-DVGXW8FO.js";import{C as B}from"./check-circle-BvKcvpo1.js";import{L as K}from"./lock-VgGjsOq_.js";import{B as re}from"./ban-B8bwPRx5.js";import{C as ae}from"./ConfirmDeleteModal-BmSQKAg0.js";import{R as te}from"./refresh-cw-CppA1Gkr.js";import{P as le}from"./plus-CV1eRhkB.js";import{E as ne,T as ie}from"./trash-DCyXKyGY.js";const oe=Y("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]),ce=Y("KeyRound",[["path",{d:"M2 18v3c0 .6.4 1 1 1h4v-3h3v-3h2l1.4-1.4a6.5 6.5 0 1 0-4-4Z",key:"167ctg"}],["circle",{cx:"16.5",cy:"7.5",r:".5",key:"1kog09"}]]),de=Y("UserCog",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["circle",{cx:"19",cy:"11",r:"2",key:"1rxg02"}],["path",{d:"M19 8v1",key:"1iffrw"}],["path",{d:"M19 13v1",key:"z4xc62"}],["path",{d:"m21.6 9.5-.87.5",key:"6lxupl"}],["path",{d:"m17.27 12-.87.5",key:"1rwhxx"}],["path",{d:"m21.6 12.5-.87-.5",key:"agvc9a"}],["path",{d:"m17.27 10-.87-.5",key:"12d57s"}]]),me=({onClose:n,onCreate:h})=>{const[U,w]=l.useState(""),[g,C]=l.useState(""),[m,z]=l.useState(["user"]),[x,A]=l.useState(""),[y,u]=l.useState(""),[c,s]=l.useState(null),[r,i]=l.useState(null),[d,k]=l.useState(null),[R,N]=l.useState(null),[M,S]=l.useState(null),[f,L]=l.useState(!1),[b,$]=l.useState(!1),a=async t=>{if(t.preventDefault(),b)return;s(null),i(null),k(null),N(null),S(null);const o=U.trim(),j=g.trim();if(!o||!j){s("Completa usuario y correo"),o||i("Requerido"),j||k("Requerido");return}if(o.length<3){s("El usuario debe tener al menos 3 caracteres"),i("Mínimo 3 caracteres");return}if(!/^[a-zA-Z0-9_-]+$/.test(o)){s("El usuario solo puede contener letras, números, guion (-) y guion bajo (_)"),i("Caracteres no permitidos");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(j)){s("Ingresa un correo válido"),k("Correo inválido");return}const P=H(),T=o.toLowerCase(),_=j.toLowerCase();if(P.some(p=>p.username.toLowerCase()===T)){s("El nombre de usuario ya existe"),i("Ya existe");return}if(P.some(p=>p.email.toLowerCase()===_)){s("El correo ya está registrado"),k("Ya registrado");return}if(!m||m.length===0){s("Selecciona al menos un rol");return}if(!x){s("Es necesario definir una contraseña"),N("Requerido");return}if(x.length<8){s("La contraseña debe tener al menos 8 caracteres"),N("Mínimo 8 caracteres");return}if(x!==y){s("Las contraseñas no coinciden"),S("No coinciden");return}const E=m.includes("admin")?"admin":m.includes("dt")?"dt":"user";$(!0);try{await h({username:o,email:j,role:E,roles:m,password:x}),L(!0),setTimeout(()=>{$(!1),n()},1200)}catch(p){console.error("Error creando usuario desde el panel:",p),s(p?.message||"Error creando usuario"),$(!1)}};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 backdrop-blur-sm",children:[e.jsx("div",{className:"absolute inset-0 bg-black/80",onClick:n}),e.jsxs("div",{className:"relative bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 rounded-2xl shadow-2xl w-full max-w-lg border border-gray-700/50 flex flex-col max-h-[90vh]",children:[e.jsx("div",{className:"relative bg-gradient-to-r from-green-600/20 via-green-500/10 to-transparent p-6 border-b border-gray-700/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-green-500/20 rounded-lg",children:e.jsx(Z,{size:24,className:"text-green-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-white",children:"Nuevo Usuario"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Crea una nueva cuenta de usuario"})]})]}),e.jsx("button",{onClick:n,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700/50 rounded-lg transition-all",disabled:f||b,children:e.jsx(D,{size:24})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-600 scrollbar-track-gray-800",children:e.jsx("div",{className:"p-6 pb-4",children:e.jsxs("form",{id:"new-user-form",onSubmit:a,className:"space-y-6",children:[c&&e.jsx("div",{className:"p-4 bg-gradient-to-r from-red-500/20 to-red-600/10 border-l-4 border-red-500 rounded-lg shadow-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(v,{size:20,className:"text-red-400 mr-3 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-red-400 font-semibold mb-1",children:"Error de validación"}),e.jsx("p",{className:"text-red-300 text-sm",children:c})]})]})}),f&&e.jsx("div",{className:"p-4 bg-gradient-to-r from-green-500/20 to-green-600/10 border-l-4 border-green-500 rounded-lg shadow-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(B,{size:20,className:"text-green-400 mr-3 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-green-400 font-semibold mb-1",children:"¡Éxito!"}),e.jsx("p",{className:"text-green-300 text-sm",children:"Usuario creado correctamente"})]})]})}),e.jsxs("div",{className:"bg-gradient-to-br from-gray-800/50 to-gray-900/50 rounded-xl p-5 border border-gray-700/50",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(O,{size:18,className:"text-green-400"}),e.jsx("h4",{className:"text-lg font-semibold text-white",children:"Información de Cuenta"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-300 mb-2",children:[e.jsx(O,{size:16,className:"mr-2 text-gray-400"}),"Nombre de Usuario"]}),e.jsx("input",{type:"text",className:`input w-full ${r?"border-red-500 focus:ring-red-500":""}`,value:U,onChange:t=>{w(t.target.value),r&&i(null),c&&s(null)},disabled:f||b,placeholder:"ej: jugador123"}),r&&e.jsxs("p",{className:"mt-1.5 text-xs text-red-400 flex items-center",children:[e.jsx(v,{size:12,className:"mr-1"}),r]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Mínimo 3 caracteres, solo letras, números, - y _"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-300 mb-2",children:[e.jsx(V,{size:16,className:"mr-2 text-gray-400"}),"Correo Electrónico"]}),e.jsx("input",{type:"email",className:`input w-full ${d?"border-red-500 focus:ring-red-500":""}`,value:g,onChange:t=>{C(t.target.value),d&&k(null),c&&s(null)},disabled:f||b,placeholder:"usuario@ejemplo.com"}),d&&e.jsxs("p",{className:"mt-1.5 text-xs text-red-400 flex items-center",children:[e.jsx(v,{size:12,className:"mr-1"}),d]})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-gray-800/60 to-gray-900/60 rounded-xl p-5 border border-gray-700/60",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(K,{size:18,className:"text-yellow-400"}),e.jsx("h4",{className:"text-lg font-semibold text-white",children:"Seguridad"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-300 mb-2",children:[e.jsx(K,{size:16,className:"mr-2 text-gray-400"}),"Contraseña"]}),e.jsx("input",{type:"password",className:`input w-full ${R?"border-red-500 focus:ring-red-500":""}`,value:x,onChange:t=>{A(t.target.value),R&&N(null),c&&s(null)},disabled:f||b,placeholder:"Al menos 8 caracteres"}),R&&e.jsxs("p",{className:"mt-1.5 text-xs text-red-400 flex items-center",children:[e.jsx(v,{size:12,className:"mr-1"}),R]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Recomendado: combiná mayúsculas, minúsculas y números."})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-300 mb-2",children:[e.jsx(ce,{size:16,className:"mr-2 text-gray-400"}),"Confirmar contraseña"]}),e.jsx("input",{type:"password",className:`input w-full ${M?"border-red-500 focus:ring-red-500":""}`,value:y,onChange:t=>{u(t.target.value),M&&S(null),c&&s(null)},disabled:f||b,placeholder:"Repite la contraseña"}),M&&e.jsxs("p",{className:"mt-1.5 text-xs text-red-400 flex items-center",children:[e.jsx(v,{size:12,className:"mr-1"}),M]})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-gray-800/50 to-gray-900/50 rounded-xl p-5 border border-gray-700/50",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(F,{size:18,className:"text-green-400"}),e.jsx("h4",{className:"text-lg font-semibold text-white",children:"Permisos y Roles"})]}),e.jsx("div",{className:"space-y-3",children:["user","dt","admin"].map(t=>e.jsxs("label",{className:`flex items-center p-3 rounded-lg border transition-all cursor-pointer ${m.includes(t)?"bg-green-500/10 border-green-500/50 hover:bg-green-500/20":"bg-gray-700/30 border-gray-600/50 hover:bg-gray-700/50"}`,children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4 text-green-500 bg-gray-600 border-gray-500 rounded focus:ring-green-500 focus:ring-2 mr-3",checked:m.includes(t),disabled:f||b,onChange:o=>{b||(z(j=>o.target.checked?Array.from(new Set([...j,t])):j.filter(I=>I!==t)),c&&s(null))}}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-white",children:t==="admin"?"Administrador":t==="dt"?"Director Técnico":"Usuario"}),e.jsx("span",{className:`text-xs font-semibold px-2 py-0.5 rounded ${t==="admin"?"bg-purple-500/20 text-purple-300":t==="dt"?"bg-blue-500/20 text-blue-300":"bg-gray-500/20 text-gray-300"}`,children:t.toUpperCase()})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:t==="admin"?"Control total del sistema":t==="dt"?"Gestión de equipos y jugadores":"Acceso básico a la plataforma"})]})]},t))})]})]})})}),e.jsx("div",{className:"flex-shrink-0 border-t border-gray-700/50 bg-gray-900/50",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{type:"button",className:"flex-1 btn-outline hover:bg-gray-700 transition-all",onClick:n,disabled:f||b,children:[e.jsx(D,{size:16,className:"mr-2"}),"Cancelar"]}),e.jsxs("button",{type:"submit",form:"new-user-form",className:"flex-1 btn-primary bg-gradient-to-r from-green-500 to-green-600 hover:from-green-600 hover:to-green-700 shadow-lg shadow-green-500/20 transition-all",disabled:f||b,children:[e.jsx(Z,{size:16,className:"mr-2"}),"Crear Usuario"]})]})})})]})]})},xe=({user:n,onClose:h,onSave:U,existingUsers:w})=>{const[g,C]=l.useState(n.username),[m,z]=l.useState(n.email),[x,A]=l.useState(Array.isArray(n.roles)&&n.roles.length?n.roles:[n.role]),[y,u]=l.useState(null),[c,s]=l.useState(null),[r,i]=l.useState(null),[d,k]=l.useState(n.status),R=a=>a?new Date(a).toISOString().slice(0,10):"",[N,M]=l.useState(R(n.suspendedUntil)),[S,f]=l.useState(n.suspendedReason||""),[L,b]=l.useState(n.banReason||""),$=a=>{a.preventDefault(),u(null),s(null),i(null);const t=g.trim(),o=m.trim();if(!t||!o){u("Completa usuario y correo"),t||s("Requerido"),o||i("Requerido");return}if(t.length<3){u("El usuario debe tener al menos 3 caracteres"),s("Mínimo 3 caracteres");return}if(!/^[a-zA-Z0-9_-]+$/.test(t)){u("El usuario solo puede contener letras, números, guion (-) y guion bajo (_)"),s("Caracteres no permitidos");return}if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o)){u("Ingresa un correo válido"),i("Correo inválido");return}const q=w??H(),P=t.toLowerCase(),T=o.toLowerCase();if(q.some(p=>p.id!==n.id&&p.username.toLowerCase()===P)){u("El nombre de usuario ya existe"),s("Ya existe");return}if(q.some(p=>p.id!==n.id&&p.email.toLowerCase()===T)){u("El correo ya está registrado"),i("Ya registrado");return}const _=x.includes("admin")?"admin":x.includes("dt")?"dt":"user",E={username:t,email:o,role:_,roles:x,status:d,suspendedUntil:null,suspendedReason:null,banReason:null};d==="suspended"?(E.suspendedUntil=N?new Date(N).toISOString():null,E.suspendedReason=S||null,E.banReason=null):d==="banned"&&(E.banReason=L||null),U(E)};return e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 backdrop-blur-sm",children:[e.jsx("div",{className:"absolute inset-0 bg-black/80",onClick:h}),e.jsxs("div",{className:"relative bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 rounded-2xl shadow-2xl w-full max-w-lg border border-gray-700/50 flex flex-col max-h-[90vh]",children:[e.jsx("div",{className:"relative bg-gradient-to-r from-blue-600/20 via-blue-500/10 to-transparent p-6 border-b border-gray-700/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-blue-500/20 rounded-lg",children:e.jsx(de,{size:24,className:"text-blue-400"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-white",children:"Editar Usuario"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Modifica la información del usuario"})]})]}),e.jsx("button",{onClick:h,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700/50 rounded-lg transition-all",children:e.jsx(D,{size:24})})]})}),e.jsx("div",{className:"flex-1 overflow-y-auto scrollbar-thin scrollbar-thumb-gray-600 scrollbar-track-gray-800",children:e.jsx("div",{className:"p-6 pb-4",children:e.jsxs("form",{id:"edit-user-form",onSubmit:$,className:"space-y-6",children:[y&&e.jsx("div",{className:"p-4 bg-gradient-to-r from-red-500/20 to-red-600/10 border-l-4 border-red-500 rounded-lg shadow-lg",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(v,{size:20,className:"text-red-400 mr-3 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h5",{className:"text-red-400 font-semibold mb-1",children:"Error de validación"}),e.jsx("p",{className:"text-red-300 text-sm",children:y})]})]})}),e.jsxs("div",{className:"bg-gradient-to-br from-gray-800/50 to-gray-900/50 rounded-xl p-5 border border-gray-700/50",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(O,{size:18,className:"text-blue-400"}),e.jsx("h4",{className:"text-lg font-semibold text-white",children:"Información de Cuenta"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-300 mb-2",children:[e.jsx(O,{size:16,className:"mr-2 text-gray-400"}),"Nombre de Usuario"]}),e.jsx("input",{type:"text",className:`input w-full ${c?"border-red-500 focus:ring-red-500":""}`,value:g,onChange:a=>{C(a.target.value),c&&s(null),y&&u(null)},placeholder:"ej: jugador123"}),c&&e.jsxs("p",{className:"mt-1.5 text-xs text-red-400 flex items-center",children:[e.jsx(v,{size:12,className:"mr-1"}),c]}),e.jsx("p",{className:"mt-1 text-xs text-gray-500",children:"Mínimo 3 caracteres, solo letras, números, - y _"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"flex items-center text-sm font-medium text-gray-300 mb-2",children:[e.jsx(V,{size:16,className:"mr-2 text-gray-400"}),"Correo Electrónico"]}),e.jsx("input",{type:"email",className:`input w-full ${r?"border-red-500 focus:ring-red-500":""}`,value:m,onChange:a=>{z(a.target.value),r&&i(null),y&&u(null)},placeholder:"usuario@ejemplo.com"}),r&&e.jsxs("p",{className:"mt-1.5 text-xs text-red-400 flex items-center",children:[e.jsx(v,{size:12,className:"mr-1"}),r]})]})]})]}),e.jsxs("div",{className:"bg-gradient-to-br from-gray-800/50 to-gray-900/50 rounded-xl p-5 border border-gray-700/50",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(F,{size:18,className:"text-blue-400"}),e.jsx("h4",{className:"text-lg font-semibold text-white",children:"Permisos y Roles"})]}),e.jsx("div",{className:"space-y-3",children:["user","dt","admin"].map(a=>e.jsxs("label",{className:`flex items-center p-3 rounded-lg border transition-all cursor-pointer ${x.includes(a)?"bg-blue-500/10 border-blue-500/50 hover:bg-blue-500/20":"bg-gray-700/30 border-gray-600/50 hover:bg-gray-700/50"}`,children:[e.jsx("input",{type:"checkbox",className:"w-4 h-4 text-blue-500 bg-gray-600 border-gray-500 rounded focus:ring-blue-500 focus:ring-2 mr-3",checked:x.includes(a),onChange:t=>{A(o=>t.target.checked?Array.from(new Set([...o,a])):o.filter(j=>j!==a))}}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"font-medium text-white",children:a==="admin"?"Administrador":a==="dt"?"Director Técnico":"Usuario"}),e.jsx("span",{className:`text-xs font-semibold px-2 py-0.5 rounded ${a==="admin"?"bg-purple-500/20 text-purple-300":a==="dt"?"bg-blue-500/20 text-blue-300":"bg-gray-500/20 text-gray-300"}`,children:a.toUpperCase()})]}),e.jsx("p",{className:"text-xs text-gray-400 mt-0.5",children:a==="admin"?"Control total del sistema":a==="dt"?"Gestión de equipos y jugadores":"Acceso básico a la plataforma"})]})]},a))})]}),e.jsxs("div",{className:"bg-gradient-to-br from-gray-800/50 to-gray-900/50 rounded-xl p-5 border border-gray-700/50",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[e.jsx(B,{size:18,className:"text-blue-400"}),e.jsx("h4",{className:"text-lg font-semibold text-white",children:"Estado de la Cuenta"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"flex items-center text-sm font-medium text-gray-300 mb-2",children:"Estado del Usuario"}),e.jsxs("select",{className:"input w-full",value:d,onChange:a=>k(a.target.value),children:[e.jsx("option",{value:"active",children:"Activo"}),e.jsx("option",{value:"suspended",children:"Suspendido"}),e.jsx("option",{value:"banned",children:"Baneado"})]})]}),d==="suspended"&&e.jsxs("div",{className:"mt-4 p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg space-y-4",children:[e.jsxs("div",{className:"flex items-center text-yellow-400 mb-2",children:[e.jsx(oe,{size:16,className:"mr-2"}),e.jsx("span",{className:"font-medium text-sm",children:"Detalles de Suspensión"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"flex items-center text-sm font-medium text-gray-300 mb-2",children:"Suspendido hasta"}),e.jsx("input",{type:"date",className:"input w-full",value:N,onChange:a=>M(a.target.value)})]}),e.jsxs("div",{children:[e.jsx("label",{className:"flex items-center text-sm font-medium text-gray-300 mb-2",children:"Motivo de suspensión"}),e.jsx("input",{type:"text",className:"input w-full",value:S,onChange:a=>f(a.target.value),placeholder:"Opcional: ej. Violación de términos"})]})]}),d==="banned"&&e.jsxs("div",{className:"mt-4 p-4 bg-red-500/10 border border-red-500/30 rounded-lg space-y-4",children:[e.jsxs("div",{className:"flex items-center text-red-400 mb-2",children:[e.jsx(re,{size:16,className:"mr-2"}),e.jsx("span",{className:"font-medium text-sm",children:"Detalles de Baneo"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"flex items-center text-sm font-medium text-gray-300 mb-2",children:"Motivo de ban"}),e.jsx("input",{type:"text",className:"input w-full",value:L,onChange:a=>b(a.target.value),placeholder:"Opcional: ej. Conducta inapropiada"})]})]})]})]})})}),e.jsx("div",{className:"flex-shrink-0 border-t border-gray-700/50 bg-gray-900/50",children:e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"flex space-x-3",children:[e.jsxs("button",{type:"button",className:"flex-1 btn-outline hover:bg-gray-700 transition-all",onClick:h,children:[e.jsx(D,{size:16,className:"mr-2"}),"Cancelar"]}),e.jsxs("button",{type:"submit",form:"edit-user-form",className:"flex-1 btn-primary bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 shadow-lg shadow-blue-500/20 transition-all",children:[e.jsx(B,{size:16,className:"mr-2"}),"Guardar Cambios"]})]})})})]})]})},we=()=>{const[n,h]=l.useState([]),[U,w]=l.useState(!1),[g,C]=l.useState(null),[m,z]=l.useState(null),[x]=X();l.useEffect(()=>{(async()=>{try{const r=await G();h(r)}catch{h([])}})()},[]),l.useEffect(()=>{x.get("new")==="1"&&w(!0)},[x]);const A=async s=>{try{const r=await J({username:s.username,email:s.email,role:s.role,roles:s.roles,password:s.password});h(i=>[r,...i.filter(d=>d.id!==r.id)]),await c()}catch(r){throw console.error("Error creando usuario desde el panel:",r),r}},y=async s=>{if(g)try{let r={...g,...s};Q.useSupabase?r=await W(g.id,s):r=await ee({...g,...s}),h(i=>i.map(d=>d.id===r.id?r:d)),await c()}catch(r){alert("Error guardando usuario: "+(r.message||r))}finally{C(null)}},u=async s=>{try{await se(s),h(r=>r.filter(i=>i.id!==s))}catch(r){alert("Error eliminando usuario: "+(r.message||r))}},c=async()=>{try{const s=await G();h(s)}catch(s){console.error("Error actualizando usuarios:",s)}};return e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Gestión de Usuarios"}),e.jsxs("span",{className:"text-sm text-gray-400",children:["(",n.length," usuarios)"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsxs("button",{className:"btn-outline flex items-center text-sm",onClick:c,children:[e.jsx(te,{size:16,className:"mr-2"}),"Refrescar"]}),e.jsxs("button",{className:"btn-primary flex items-center",onClick:()=>w(!0),children:[e.jsx(le,{size:16,className:"mr-2"}),"Nuevo usuario"]})]})]}),e.jsx("div",{className:"bg-dark-light rounded-lg border border-gray-800 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-dark-lighter text-xs uppercase text-gray-400 border-b border-gray-800",children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Usuario"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Correo"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Roles"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Estado"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Acciones"})]})}),e.jsx("tbody",{children:n.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-6 text-center text-gray-400",children:"No hay usuarios."})}):n.map(s=>e.jsxs("tr",{className:"border-b border-gray-800 hover:bg-dark-lighter",children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden mr-3",children:e.jsx("img",{src:s.avatar||`https://ui-avatars.com/api/?name=${encodeURIComponent(s.username)}&background=111827&color=fff&size=128`,alt:s.username})}),e.jsx("span",{className:"font-medium",children:s.username})]})}),e.jsx("td",{className:"px-4 py-3 text-center",children:s.email}),e.jsx("td",{className:"px-4 py-3 text-center",children:(Array.isArray(s.roles)?s.roles:[s.role]).map(r=>e.jsx("span",{className:`inline-block px-2 py-1 text-xs rounded-full mr-1 ${r==="admin"?"bg-neon-red/20 text-neon-red":r==="dt"?"bg-neon-green/20 text-neon-green":"bg-secondary/20 text-secondary"}`,children:r},r))}),e.jsx("td",{className:"px-4 py-3 text-center",children:s.status||"active"}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("div",{className:"flex justify-center gap-2",children:[e.jsx("button",{className:"p-1 text-gray-400 hover:text-primary",onClick:()=>C(s),children:e.jsx(ne,{size:16})}),e.jsx("button",{className:"p-1 text-gray-400 hover:text-red-500",onClick:()=>z(s),children:e.jsx(ie,{size:16})})]})})]},s.id))})]})})}),U&&e.jsx(me,{onClose:()=>w(!1),onCreate:A}),g&&e.jsx(xe,{user:g,existingUsers:n,onClose:()=>C(null),onSave:y}),m&&e.jsx(ae,{user:{id:m.id,username:m.username},onCancel:()=>z(null),onConfirm:u,label:"usuario"})]})};export{we as default};
