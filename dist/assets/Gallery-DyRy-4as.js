import{k as Z,x as N,y as O,r as h,d as X,b as _,j as e,U as Y,X as C,A as ee}from"./index-DTVNIeXw.js";import{P as ae}from"./PageHeader-CDa_z5ok.js";import{S as se}from"./search-BFl4Rdls.js";import{P as k}from"./plus-CV1eRhkB.js";import{C as re}from"./calendar-ChXpFKNL.js";import{I as P}from"./image-CWVeUWZ1.js";import{U as te}from"./upload-DaXijVgU.js";const le=Z("Tag",[["path",{d:"M12 2H2v10l9.29 9.29c.94.94 2.48.94 3.42 0l6.58-6.58c.94-.94.94-2.48 0-3.42L12 2Z",key:"14b2ls"}],["path",{d:"M7 7h.01",key:"7u93v4"}]]),A="media",V=()=>N.useSupabase&&!!N.supabase.url&&!!N.supabase.anonKey,ie=()=>{if(!V())return null;try{return O()}catch(i){return console.warn("supabaseStorage: Supabase not configured:",i),null}},oe=async(i,j="gallery")=>{const r=ie();if(!r)throw new Error("Supabase no está configurado");const b=i.name.split(".").pop(),t=`${j}/${Date.now()}-${Math.random().toString(36).substring(2)}.${b}`;try{const{data:c,error:d}=await r.storage.from(A).upload(t,i,{cacheControl:"3600",upsert:!1});if(d)throw console.error("Error uploading file:",d),new Error(`Error al subir archivo: ${d.message}`);const{data:y}=r.storage.from(A).getPublicUrl(t);if(!y.publicUrl)throw new Error("No se pudo obtener la URL pública del archivo");return{url:y.publicUrl,fileName:t}}catch(c){throw console.error("supabaseStorage: Error uploading file:",c),c}},ne=async(i,j="gallery")=>{let r;if(typeof i=="string"){const y=await(await fetch(i)).blob(),f=y.type||"image/jpeg",z=`media-${Date.now()}.${f.split("/")[1]||"jpg"}`;r=new File([y],z,{type:f})}else r=i;if(!r.type.startsWith("image/")&&!r.type.startsWith("video/"))throw new Error("El archivo debe ser una imagen o video");const b=r.type.startsWith("video/"),t=b?50*1024*1024:10*1024*1024;if(r.size>t){const d=b?"50MB":"10MB";throw new Error(`El ${b?"video":"archivo"} no puede ser mayor a ${d}`)}const c=await oe(r,j);return{url:c.url,fileName:c.fileName,fileSize:r.size,mimeType:r.type}},ce=()=>V(),B={title:"",type:"image",url:"",thumbnailUrl:"",category:"",description:""},be=()=>{const[i,j]=h.useState("all"),[r,b]=h.useState(""),[t,c]=h.useState(null),{mediaItems:d,addMediaItem:y,mediaLoading:f}=X(),{user:z}=_(),[G,U]=h.useState(!1),[s,v]=h.useState(()=>({...B})),[o,x]=h.useState(null),[E,p]=h.useState(""),[n,I]=h.useState(!1),R=[{id:"f1",type:"image",title:"Final de la Liga Master 2024",description:"Rayo Digital FC vs Atlético Pixelado",category:"Torneos",image:"https://images.unsplash.com/photo-1511406361295-0a1ff814c0ce?ixlib=rb-4.1.0",uploader:"admin",uploadDate:"2024-12-15"}],T=d&&d.length?d:R,W=Array.from(new Set(T.map(a=>a.category))).filter(Boolean),$=T.filter(a=>{if(i!=="all"&&a.category!==i)return!1;const l=(a.title||"").toLowerCase(),u=(a.description||"").toLowerCase();return!(r&&!l.includes(r.toLowerCase())&&!u.includes(r.toLowerCase()))}),q=()=>{v({...B}),x(null),p("")},w=()=>{U(!1),q()},Q=a=>{v(l=>({...l,type:a})),a!=="image"&&(x(null),p(""))},H=async a=>{const l=a.target.files?.[0],u=a.target;if(!l){x(null),p("");return}if(!l.type.startsWith("image/")&&!l.type.startsWith("video/")){x(null),p("Solo se permiten archivos de imagen o video."),u.value="";return}const S=l.type.startsWith("video/"),J=S?50*1024*1024:10*1024*1024;if(l.size>J){x(null),p(`El ${S?"video":"archivo"} no puede ser mayor a ${S?"50MB":"10MB"}.`),u.value="";return}I(!0),p("");try{let g,M=l.size,L=l.type;if(ce()){const m=await ne(l,"gallery");g=m.url,M=m.fileSize,L=m.mimeType,console.log(`✅ ${S?"Video":"Imagen"} subida a Supabase Storage:`,m.url)}else{const m=new FileReader;g=await new Promise((K,F)=>{m.onloadend=()=>{const D=typeof m.result=="string"?m.result:"";D?K(D):F(new Error("No se pudo leer la imagen"))},m.onerror=()=>F(new Error("Error al leer la imagen")),m.readAsDataURL(l)})}x({name:l.name,dataUrl:g,fileSize:M,mimeType:L})}catch(g){console.error("Error procesando imagen:",g),x(null),p(g instanceof Error?g.message:"Error al procesar la imagen.")}finally{I(!1),u.value=""}};return e.jsxs("div",{children:[e.jsx(ae,{title:"Galería",subtitle:"Colección de imágenes, videos y contenido multimedia de La Virtual Zone.",image:"https://images.unsplash.com/photo-1511406361295-0a1ff814c0ce?ixlib=rb-4.1.0"}),e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-start md:items-center gap-4 mb-8",children:[e.jsx("div",{className:"w-full md:w-auto order-2 md:order-1",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx("button",{onClick:()=>j("all"),className:`px-3 py-1.5 rounded-lg text-sm ${i==="all"?"bg-primary text-white":"bg-dark-light text-gray-300 hover:bg-dark-lighter"}`,children:"Todos"}),W.map(a=>e.jsx("button",{onClick:()=>j(a),className:`px-3 py-1.5 rounded-lg text-sm ${i===a?"bg-primary text-white":"bg-dark-light text-gray-300 hover:bg-dark-lighter"}`,children:a},a))]})}),e.jsxs("div",{className:"flex w-full md:w-auto order-1 md:order-2 space-x-2",children:[e.jsxs("div",{className:"relative flex-grow max-w-xs",children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(se,{size:16,className:"text-gray-500"})}),e.jsx("input",{type:"text",placeholder:"Buscar...",className:"input pl-10 w-full",value:r,onChange:a=>b(a.target.value)})]}),e.jsxs("button",{className:"btn-primary",onClick:()=>U(!0),children:[e.jsx(k,{size:16,className:"mr-2"}),"Subir"]})]})]}),$.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:$.map(a=>e.jsxs("div",{className:"card overflow-hidden group cursor-pointer",onClick:()=>c(a),children:[e.jsxs("div",{className:"aspect-video relative overflow-hidden",children:[e.jsx("img",{src:a.thumbnailUrl||a.image||a.url,alt:a.title,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110"}),e.jsx("div",{className:"absolute top-3 left-3",children:e.jsx("span",{className:`inline-block px-2 py-1 text-xs font-medium rounded-full ${a.type==="video"||a.type==="clip"?"bg-neon-red/20 text-neon-red":"bg-neon-blue/20 text-neon-blue"}`,children:a.type==="video"||a.type==="clip"?"Video":"Imagen"})})]}),e.jsxs("div",{className:"p-4",children:[e.jsx("h3",{className:"font-bold mb-2 group-hover:text-primary transition-colors",children:a.title}),a.description&&e.jsx("p",{className:"text-sm text-gray-400 mb-4",children:a.description}),e.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-500",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Y,{size:14,className:"mr-1"}),e.jsx("span",{children:a.uploader||a.author})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(re,{size:14,className:"mr-1"}),e.jsx("span",{children:new Date(a.uploadDate||a.date).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"2-digit"})})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx(le,{size:14,className:"mr-1"}),e.jsx("span",{className:"capitalize",children:a.category})]})]})]})]},a.id))}):e.jsxs("div",{className:"text-center py-12",children:[e.jsx(P,{size:48,className:"mx-auto mb-4 text-gray-600"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"No se encontraron resultados"}),e.jsx("p",{className:"text-gray-400",children:"No hay resultados que coincidan con tu búsqueda. Intenta con otros términos o filtros."})]}),t&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/80",onClick:()=>c(null)}),e.jsxs("div",{className:"relative bg-gray-900 rounded-lg shadow-2xl w-full max-w-4xl overflow-hidden",children:[e.jsx("button",{onClick:()=>c(null),className:"absolute top-3 right-3 bg-dark p-1.5 rounded text-gray-300 hover:text-white z-10","aria-label":"Cerrar",children:e.jsx(C,{size:18})}),e.jsx("div",{className:"w-full bg-black flex items-center justify-center aspect-video",children:t.type==="video"||t.type==="clip"?e.jsx("video",{controls:!0,className:"w-full h-full",children:e.jsx("source",{src:t.url||t.thumbnailUrl})}):e.jsx("img",{src:t.url||t.image||t.thumbnailUrl,alt:t.title,className:"max-h-[80vh] w-auto object-contain"})}),e.jsxs("div",{className:"p-4 border-t border-gray-800",children:[e.jsx("h4",{className:"font-bold",children:t.title}),t.description&&e.jsx("p",{className:"text-gray-400 text-sm mt-1",children:t.description})]})]})]}),G&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 backdrop-blur-sm animate-scaleIn",children:[e.jsx("div",{className:"absolute inset-0 bg-black/80",onClick:w}),e.jsxs("div",{className:"relative bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900 rounded-2xl shadow-2xl w-full max-w-lg overflow-hidden border border-gray-700/50",children:[e.jsx("div",{className:"relative bg-gradient-to-r from-primary/20 via-primary/10 to-transparent p-6 border-b border-gray-700/50",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"p-2 bg-primary/20 rounded-lg",children:e.jsx(k,{size:24,className:"text-primary"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-white",children:"Subir contenido"}),e.jsx("p",{className:"text-sm text-gray-400",children:"Agrega una imagen o video a la galería"})]})]}),e.jsx("button",{onClick:w,className:"p-2 text-gray-400 hover:text-white hover:bg-gray-700/50 rounded-lg transition-all","aria-label":"Cerrar",children:e.jsx(C,{size:24})})]})}),e.jsx("div",{className:"p-6",children:e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Título"}),e.jsx("input",{className:"input w-full",value:s.title,onChange:a=>v({...s,title:a.target.value})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Tipo"}),e.jsxs("select",{className:"input w-full",value:s.type,onChange:a=>Q(a.target.value),children:[e.jsx("option",{value:"image",children:"Imagen"}),e.jsx("option",{value:"video",children:"Video"}),e.jsx("option",{value:"clip",children:"Clip"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Categoría"}),e.jsx("input",{className:"input w-full",value:s.category,onChange:a=>v({...s,category:a.target.value}),placeholder:"Torneos, Club, etc."})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"URL del contenido"}),e.jsx("input",{className:"input w-full disabled:opacity-50 disabled:cursor-not-allowed",value:s.url,onChange:a=>v({...s,url:a.target.value}),placeholder:"https://...",disabled:!!o}),o?e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Se usará el archivo local seleccionado."}):e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Pega un enlace o elige una imagen de tu equipo."})]}),(s.type==="image"||s.type==="video"||s.type==="clip")&&e.jsxs("div",{children:[e.jsxs("label",{className:"block text-sm text-gray-400 mb-2 font-medium",children:["Archivo multimedia ",N.useSupabase?"(se subirá a la nube)":"(se guardará localmente)"]}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"file",accept:"image/*,video/*",onChange:H,className:"hidden",id:"image-upload",disabled:n}),e.jsx("label",{htmlFor:"image-upload",className:`flex items-center justify-center w-full p-4 border-2 border-dashed rounded-lg transition-all cursor-pointer group ${n?"border-yellow-500 bg-yellow-500/10 cursor-not-allowed":"border-gray-600 hover:border-primary hover:bg-primary/5"}`,children:e.jsxs("div",{className:"flex flex-col items-center space-y-2",children:[e.jsx("div",{className:`p-3 rounded-full transition-all ${n?"bg-yellow-500/20":"bg-primary/10 group-hover:bg-primary/20"}`,children:n?e.jsx(te,{size:24,className:"text-yellow-500 animate-pulse"}):e.jsx(P,{size:24,className:"text-primary"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:`text-sm font-medium transition-colors ${n?"text-yellow-400":"text-gray-300 group-hover:text-white"}`,children:n?"Subiendo imagen...":o?"Cambiar imagen":"Seleccionar imagen"}),e.jsx("p",{className:"text-xs text-gray-500",children:n?"Procesando archivo...":N.useSupabase?"Imágenes: PNG, JPG, GIF hasta 10MB | Videos: MP4, AVI hasta 50MB":"Imágenes: PNG, JPG, GIF hasta 10MB | Videos: MP4, AVI hasta 50MB (local)"})]})]})})]}),E&&e.jsxs("div",{className:"mt-2 flex items-center gap-2 p-2 bg-red-500/10 border border-red-500/20 rounded-lg",children:[e.jsx(ee,{size:16,className:"text-red-400 flex-shrink-0"}),e.jsx("p",{className:"text-xs text-red-400",children:E})]}),o&&!n&&e.jsx("div",{className:"mt-4 p-4 bg-gray-800/50 rounded-lg border border-gray-700",children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:o.dataUrl,alt:"Vista previa",className:"w-16 h-16 object-cover rounded-lg border border-gray-600"}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-200 text-sm",children:o.name}),e.jsxs("div",{className:"flex items-center gap-2 mt-1",children:[e.jsx("p",{className:"text-xs text-gray-400",children:o.fileSize?`${(o.fileSize/1024/1024).toFixed(2)} MB`:"Tamaño desconocido"}),N.useSupabase&&e.jsx("span",{className:"inline-flex items-center px-2 py-0.5 rounded text-xs bg-green-500/20 text-green-400",children:"☁️ En la nube"})]})]}),e.jsx("button",{type:"button",className:"p-2 text-red-400 hover:text-red-300 hover:bg-red-500/10 rounded-lg transition-all",onClick:()=>{x(null),p("")},title:"Quitar imagen",disabled:n,children:e.jsx(C,{size:16})})]})})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"URL de miniatura (opcional)"}),e.jsx("input",{className:"input w-full",value:s.thumbnailUrl,onChange:a=>v({...s,thumbnailUrl:a.target.value}),placeholder:"https://..."})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm text-gray-400 mb-1",children:"Descripción (opcional)"}),e.jsx("textarea",{className:"input w-full resize-none",rows:3,value:s.description,onChange:a=>v({...s,description:a.target.value}),placeholder:"Describe brevemente el contenido..."})]})]})}),e.jsx("div",{className:"bg-gradient-to-r from-gray-900 via-gray-800 to-gray-900 p-6 border-t border-gray-700/50",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-400",children:[e.jsx("div",{className:"w-2 h-2 bg-primary rounded-full animate-pulse"}),e.jsx("span",{children:"Completa los campos requeridos para subir"})]}),e.jsxs("div",{className:"flex space-x-3 w-full sm:w-auto",children:[e.jsxs("button",{type:"button",className:"flex-1 sm:flex-none btn-outline hover:bg-gray-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed",onClick:w,disabled:f||n,children:[e.jsx(C,{size:16,className:"mr-2"}),"Cancelar"]}),e.jsx("button",{className:"flex-1 sm:flex-none btn-primary bg-gradient-to-r from-primary to-primary/80 hover:from-primary/90 hover:to-primary/70 shadow-lg shadow-primary/20 transition-all disabled:opacity-50 disabled:cursor-not-allowed",onClick:async()=>{const a=s.title.trim(),l=o?.dataUrl||s.url.trim();if(!(!a||!l||f||n))try{const u={id:`media-${Date.now()}`,title:a,type:s.type,url:l,thumbnailUrl:o?.dataUrl||s.thumbnailUrl.trim()||l,uploadDate:new Date().toISOString(),uploader:z?.username||"anon",category:s.category||"General",likes:0,views:0,description:s.description.trim()||void 0,fileSize:o?.fileSize,mimeType:o?.mimeType};await y(u),w()}catch(u){console.error("Error al subir contenido:",u)}},disabled:f||n||!s.title.trim()||!o?.dataUrl&&!s.url.trim(),children:f?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 border-2 border-white/30 border-t-white rounded-full animate-spin mr-2"}),"Subiendo..."]}):e.jsxs(e.Fragment,{children:[e.jsx(k,{size:16,className:"mr-2"}),"Subir contenido"]})})]})]})})]})]})]})]})};export{be as default};
