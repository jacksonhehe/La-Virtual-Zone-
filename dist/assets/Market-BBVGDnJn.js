import{d as M,r as n,x as m,j as e,f as v,q as w}from"./index-DTVNIeXw.js";const L=()=>{const{marketStatus:c,updateMarketStatus:k,transfers:u,offers:p,clubs:i,refreshOffers:b,refreshTransfers:g,refreshMarketStatus:f}=M(),[t,o]=n.useState(null),[j,N]=n.useState(!1),[h,y]=n.useState(null),l=n.useRef(null),x=n.useCallback((s,r,a=4e3)=>{l.current&&window.clearTimeout(l.current),y({type:s,message:r}),l.current=window.setTimeout(()=>{y(null),l.current=null},a)},[]);n.useEffect(()=>()=>{l.current&&window.clearTimeout(l.current)},[]);const C=()=>o({next:!c}),d=n.useCallback(async s=>{try{return N(!0),await Promise.all([b(),g(),f()]),s?.silent||x("success","Datos sincronizados con Supabase."),!0}catch(r){return console.error("AdminMarket - Error syncing with Supabase:",r),x("error","No se pudo sincronizar con Supabase. Intenta nuevamente."),!1}finally{N(!1)}},[f,b,g,x]);n.useEffect(()=>{if(!m.useSupabase)return;d({silent:!0});const s=window.setInterval(()=>{d({silent:!0})},m.sync.intervalMinutes*60*1e3);return()=>window.clearInterval(s)},[d]);const S=async()=>{if(!t)return;k(t.next),o(null);const s=t.next?"Mercado abierto correctamente.":"Mercado cerrado correctamente.";x("success",s),m.useSupabase&&d({silent:!0})};return e.jsxs("div",{children:[h&&e.jsx("div",{className:`mb-4 rounded-lg border px-4 py-3 text-sm ${h.type==="success"?"border-green-700 bg-green-500/10 text-green-200":"border-red-700 bg-red-500/10 text-red-200"}`,role:"status","aria-live":"polite",children:h.message}),e.jsxs("div",{className:"flex flex-col gap-4 md:flex-row md:items-center md:justify-between mb-6",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("h2",{className:"text-2xl font-bold",children:"Mercado - Transferencias"}),e.jsxs("span",{className:`inline-flex items-center px-2 py-1 text-xs rounded-full ${c?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"}`,children:[e.jsx("span",{className:`w-1.5 h-1.5 rounded-full mr-1 ${c?"bg-green-500":"bg-red-500"}`}),c?"Abierto":"Cerrado"]})]}),m.useSupabase&&e.jsx("button",{className:"btn-outline text-sm px-4 py-2 disabled:opacity-60 disabled:cursor-not-allowed",onClick:()=>{d()},disabled:j,children:j?"Sincronizando…":"Refrescar desde Supabase"})]}),e.jsx("div",{className:"mb-4",children:e.jsx("button",{className:"btn-primary",onClick:C,children:c?"Cerrar mercado":"Abrir mercado"})}),e.jsxs("div",{className:"bg-dark-light rounded-lg border border-gray-800 overflow-hidden mb-8",children:[e.jsx("div",{className:"p-4 border-b border-gray-800",children:e.jsx("h3",{className:"text-xl font-bold",children:"Transferencias"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-dark-lighter text-xs uppercase text-gray-400 border-b border-gray-800",children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Fecha"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Jugador"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Desde"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Hacia"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Monto"})]})}),e.jsx("tbody",{children:u.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-6 text-center text-gray-400",children:"No hay transferencias registradas."})}):u.slice().sort((s,r)=>new Date(r.date).getTime()-new Date(s.date).getTime()).map(s=>e.jsxs("tr",{className:"border-b border-gray-800 hover:bg-dark-lighter",children:[e.jsx("td",{className:"px-4 py-3",children:v(s.date)}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-medium",children:s.playerName})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("div",{className:"inline-flex items-center justify-center gap-2",children:[(()=>{const r=i.find(a=>a.name===s.fromClub);return r?e.jsx("img",{src:r.logo,alt:s.fromClub,className:"w-5 h-5"}):null})(),e.jsx("span",{children:s.fromClub})]})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("div",{className:"inline-flex items-center justify-center gap-2",children:[(()=>{const r=i.find(a=>a.name===s.toClub);return r?e.jsx("img",{src:r.logo,alt:s.toClub,className:"w-5 h-5"}):null})(),e.jsx("span",{children:s.toClub})]})}),e.jsx("td",{className:"px-4 py-3 text-right font-bold",children:w(s.fee)})]},s.id))})]})})]}),e.jsxs("div",{className:"bg-dark-light rounded-lg border border-gray-800 overflow-hidden",children:[e.jsx("div",{className:"p-4 border-b border-gray-800",children:e.jsx("h3",{className:"text-xl font-bold",children:"Ofertas"})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-dark-lighter text-xs uppercase text-gray-400 border-b border-gray-800",children:[e.jsx("th",{className:"px-4 py-3 text-left",children:"Fecha"}),e.jsx("th",{className:"px-4 py-3 text-left",children:"Jugador"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Desde"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Hacia"}),e.jsx("th",{className:"px-4 py-3 text-right",children:"Monto"}),e.jsx("th",{className:"px-4 py-3 text-center",children:"Estado"})]})}),e.jsx("tbody",{children:p.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:6,className:"px-4 py-6 text-center text-gray-400",children:"No hay ofertas registradas."})}):p.slice().sort((s,r)=>new Date(r.date).getTime()-new Date(s.date).getTime()).map(s=>e.jsxs("tr",{className:"border-b border-gray-800 hover:bg-dark-lighter",children:[e.jsx("td",{className:"px-4 py-3",children:v(s.date)}),e.jsx("td",{className:"px-4 py-3",children:e.jsx("span",{className:"font-medium",children:s.playerName})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("div",{className:"inline-flex items-center justify-center gap-2",children:[(()=>{const r=i.find(a=>a.name===s.fromClub);return r?e.jsx("img",{src:r.logo,alt:s.fromClub,className:"w-5 h-5"}):null})(),e.jsx("span",{children:s.fromClub})]})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("div",{className:"inline-flex items-center justify-center gap-2",children:[(()=>{const r=i.find(a=>a.name===s.toClub);return r?e.jsx("img",{src:r.logo,alt:s.toClub,className:"w-5 h-5"}):null})(),e.jsx("span",{children:s.toClub})]})}),e.jsx("td",{className:"px-4 py-3 text-right font-bold",children:w(s.amount)}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:`inline-block px-2 py-1 text-xs rounded-full ${s.status==="pending"?"bg-yellow-500/20 text-yellow-400":s.status==="accepted"?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"}`,children:s.status==="pending"?"Pendiente":s.status==="accepted"?"Aceptada":"Rechazada"})})]},s.id))})]})})]}),t&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 animate-in fade-in duration-200",children:[e.jsx("div",{className:"absolute inset-0 bg-black/60 backdrop-blur-sm",onClick:()=>o(null)}),e.jsxs("div",{className:"relative bg-dark-light border border-gray-700 rounded-xl p-6 w-full max-w-md shadow-2xl animate-in slide-in-from-bottom-4 duration-300",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[e.jsx("div",{className:`p-2 rounded-full ${t.next?"bg-green-500/20 text-green-400":"bg-red-500/20 text-red-400"}`,children:t.next?e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})}):e.jsx("svg",{className:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})})}),e.jsx("h4",{className:"text-xl font-bold text-white",children:t.next?"Abrir Mercado de Fichajes":"Cerrar Mercado de Fichajes"})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("p",{className:"text-gray-300 leading-relaxed",children:t.next?e.jsxs(e.Fragment,{children:["Estás a punto de ",e.jsx("span",{className:"text-green-400 font-semibold",children:"abrir el mercado de fichajes"}),". Los clubes podrán hacer ofertas y transferencias de jugadores."]}):e.jsxs(e.Fragment,{children:["Estás a punto de ",e.jsx("span",{className:"text-red-400 font-semibold",children:"cerrar el mercado de fichajes"}),". Se detendrán todas las ofertas y transferencias activas."]})}),e.jsx("div",{className:`mt-4 p-3 rounded-lg border ${t.next?"bg-green-500/10 border-green-500/30":"bg-red-500/10 border-red-500/30"}`,children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("svg",{className:"w-4 h-4 text-yellow-400",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"})}),e.jsx("span",{className:"text-sm text-gray-300",children:"Esta acción afecta a todos los equipos del sistema."})]})})]}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx("button",{className:"px-4 py-2 text-gray-300 hover:text-white hover:bg-gray-700 rounded-lg transition-colors duration-200",onClick:()=>o(null),children:"Cancelar"}),e.jsx("button",{className:`px-4 py-2 font-semibold rounded-lg transition-all duration-200 ${t.next?"bg-green-600 hover:bg-green-700 text-white":"bg-red-600 hover:bg-red-700 text-white"}`,onClick:()=>{S()},children:t.next?"Abrir Mercado":"Cerrar Mercado"})]})]})]})]})};export{L as default};
