import{k as w,x as R,y as _,O as B,d as q,b as O,r as b,j as e,L as l}from"./index-DTVNIeXw.js";import{C as z}from"./calendar-ChXpFKNL.js";import{C as V}from"./chevron-left-DnlDT4R9.js";import{A as H}from"./arrow-right-BaRtFOXo.js";const P=w("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]),F=w("Share",[["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["polyline",{points:"16 6 12 2 8 6",key:"m901s6"}],["line",{x1:"12",x2:"12",y1:"2",y2:"15",key:"1p0rca"}]]),Z=w("ThumbsUp",[["path",{d:"M7 10v12",key:"1qc93n"}],["path",{d:"M15 5.88 14 10h5.83a2 2 0 0 1 1.92 2.56l-2.33 8A2 2 0 0 1 17.5 22H4a2 2 0 0 1-2-2v-8a2 2 0 0 1 2-2h2.76a2 2 0 0 0 1.79-1.11L12 2h0a3.13 3.13 0 0 1 3 3.88Z",key:"y3tblf"}]]),N="virtual_zone_comments",k="blog_comments",C=()=>{if(!R.useSupabase)return null;try{return _()}catch(t){return console.warn("CommentService: Supabase unavailable",t),null}},S=t=>({id:t.id,postId:t.post_id,author:t.author,authorAvatar:t.author_avatar,content:t.content,date:t.date,likes:Number(t.likes??0),replies:t.replies||[]}),A=t=>({id:t.id,post_id:t.postId,author:t.author,author_avatar:t.authorAvatar,content:t.content,date:t.date,likes:t.likes,replies:t.replies||[]}),D=()=>{try{const t=localStorage.getItem(N);return t?JSON.parse(t):[]}catch(t){return console.error("CommentService: error parsing local comments",t),localStorage.removeItem(N),[]}},f=t=>{try{localStorage.setItem(N,JSON.stringify(t))}catch(o){console.error("CommentService: error saving local comments",o)}},T=()=>[{id:"sample-comment-1",postId:"post1",author:"pixelmanager",authorAvatar:"https://ui-avatars.com/api/?name=pixelmanager&background=10b981&color=fff&size=128",content:"Gran artículo, muy buen análisis. Espero ver más contenido como este.",date:new Date(Date.now()-2880*60*1e3).toISOString(),likes:3},{id:"sample-comment-2",postId:"post1",author:"neonmanager",authorAvatar:"https://ui-avatars.com/api/?name=neonmanager&background=c026d3&color=fff&size=128",content:"Interesante perspectiva, aunque no estoy de acuerdo con algunos puntos. En mi opinión, la presión alta puede ser riesgosa si no se ejecuta correctamente.",date:new Date(Date.now()-4320*60*1e3).toISOString(),likes:1},{id:"sample-comment-3",postId:"post2",author:"tacticmaster",authorAvatar:"https://ui-avatars.com/api/?name=tacticmaster&background=059669&color=fff&size=128",content:"Excelente análisis táctico. La presión alta es fundamental en el fútbol moderno. ¿Podrías hacer un artículo sobre transiciones defensivas?",date:new Date(Date.now()-1440*60*1e3).toISOString(),likes:5},{id:"sample-comment-4",postId:"post2",author:"futbolfan",authorAvatar:"https://ui-avatars.com/api/?name=futbolfan&background=dc2626&color=fff&size=128",content:"Totalmente de acuerdo. En La Virtual Zone hemos visto cómo equipos con buena presión alta dominan los partidos.",date:new Date(Date.now()-720*60*1e3).toISOString(),likes:2}],J=async t=>{const o=C();if(!o)return null;const{data:a,error:n}=await o.from(k).insert(A(t)).select().single();return n?(console.error("CommentService: insert error",n),null):a?S(a):null},G=async t=>{const o=C();if(!o)return null;const{data:a,error:n}=await o.from(k).update(A(t)).eq("id",t.id).select().single();return n?(console.error("CommentService: update error",n),null):a?S(a):null},$=async()=>{const t=C();if(!t)return[];const{data:o,error:a}=await t.from(k).select("*").order("date",{ascending:!1});return a?(console.error("CommentService: fetch error",a),[]):(o||[]).map(S)},K=()=>{D().length===0&&f(T())},Y=async()=>{const t=await $();if(t.length>0){f(t);return}K()},Q=async t=>(await E()).filter(a=>a.postId===t).sort((a,n)=>new Date(n.date).getTime()-new Date(a.date).getTime()),W=async(t,o,a,n={})=>{const i=await E(),x=new Date,c=o?.trim()||"Usuario Anónimo",g=n.avatarUrl&&n.avatarUrl.trim()?n.avatarUrl.trim():`https://ui-avatars.com/api/?name=${encodeURIComponent(c)}&background=111827&color=fff&size=128`,p={id:`comment-${x.getTime()}-${Math.random().toString(36).slice(2,9)}`,postId:t,author:c,authorAvatar:g,content:a.trim(),date:x.toISOString(),likes:0,replies:[]},u=await J(p)||p,v=[u,...i];return f(v),u},X=async(t,o)=>{const a=await E(),n=a.findIndex(g=>g.id===t);if(n===-1)return null;const i={...a[n],likes:o},c=await G(i)||i;return a[n]=c,f(a),c},E=async()=>{const t=await $();if(t.length>0)return f(t),t;const o=D();if(o.length===0){const a=T();return f(a),a}return o},re=()=>{const{postId:t}=B(),{posts:o,refreshPosts:a}=q(),{user:n}=O(),[i,x]=b.useState(""),[c,g]=b.useState(!1),[p,h]=b.useState(""),[u,v]=b.useState([]),r=o.find(s=>s.slug===t||s.id===t);b.useEffect(()=>{a(),Y().catch(s=>{console.error("BlogPost: failed to initialize comments",s)})},[a]),b.useEffect(()=>{let s=!1;return(async()=>{if(!r)return;const j=await Q(r.id);s||v(j)})(),()=>{s=!0}},[r]);const M=async s=>{if(s.preventDefault(),!r||!i.trim()){h("Por favor, escribe un comentario antes de enviar.");return}if(i.trim().length<5){h("El comentario debe tener al menos 5 caracteres.");return}g(!0),h("");try{const d=n?.username?.trim()||n?.email?.split("@")[0]||"Usuario Anónimo",j=n?.avatar?.trim(),m=await W(r.id,d,i,{avatarUrl:j});console.log("BlogPost: Comment submitted:",m),v(y=>[m,...y]),x(""),h("¡Comentario enviado exitosamente!"),setTimeout(()=>{h("")},3e3)}catch(d){console.error("BlogPost: Error submitting comment:",d),h("Error al enviar el comentario. Inténtalo de nuevo.")}finally{g(!1)}},U=async s=>{const d=u.find(m=>m.id===s);if(!d)return;const j=d.likes+1;try{const m=await X(s,j);m&&v(y=>y.map(L=>L.id===s?m:L))}catch(m){console.error("BlogPost: failed to like comment",m)}};if(!r)return e.jsxs("div",{className:"container mx-auto px-4 py-16 text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Artículo no encontrado"}),e.jsx("p",{className:"text-gray-400 mb-8",children:"El artículo que estás buscando no existe o ha sido eliminado."}),e.jsx(l,{to:"/blog",className:"btn-primary",children:"Volver al Blog"})]});const I=o.filter(s=>s.id!==r.id&&s.category===r.category).slice(0,2);return e.jsxs("div",{children:[e.jsxs("div",{className:"relative h-80 overflow-hidden",children:[e.jsxs("div",{className:"absolute inset-0",children:[e.jsx("img",{src:r.image,alt:r.title,className:"w-full h-full object-cover"}),e.jsx("div",{className:"absolute inset-0 bg-gradient-to-t from-dark to-dark/70"})]}),e.jsxs("div",{className:"container mx-auto px-4 h-full flex flex-col justify-end pb-8 relative z-10",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[e.jsx("span",{className:"bg-primary/80 text-white rounded-full px-3 py-1 text-sm mr-3",children:r.category}),e.jsxs("span",{className:"text-gray-300 flex items-center text-sm",children:[e.jsx(z,{size:14,className:"mr-1"}),new Date(r.date).toLocaleDateString("es-ES",{day:"2-digit",month:"long",year:"numeric"})]})]}),e.jsx("h1",{className:"text-3xl md:text-4xl font-bold text-white mb-2",children:r.title}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-8 h-8 rounded-full overflow-hidden mr-2",children:e.jsx("img",{src:`https://ui-avatars.com/api/?name=${r.author}&background=111827&color=fff&size=128`,alt:r.author,className:"w-full h-full object-cover"})}),e.jsxs("span",{className:"text-gray-300",children:["Por ",r.author]})]})]})]}),e.jsx("div",{className:"container mx-auto px-4 py-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"lg:col-span-2",children:[e.jsx("div",{className:"mb-6",children:e.jsxs(l,{to:"/blog",className:"inline-flex items-center text-primary hover:text-primary-light",children:[e.jsx(V,{size:16,className:"mr-1"}),e.jsx("span",{children:"Volver al Blog"})]})}),e.jsxs("div",{className:"bg-dark-light rounded-lg border border-gray-800 p-6 md:p-8 mb-8",children:[e.jsx("div",{className:"prose prose-invert max-w-none",children:e.jsx("div",{dangerouslySetInnerHTML:{__html:r.content}})}),e.jsxs("div",{className:"flex items-center justify-between mt-8 pt-6 border-t border-gray-800",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("button",{className:"bg-dark-lighter hover:bg-dark rounded-full p-2 transition-colors",onClick:()=>{const s=window.location.href;navigator.clipboard.writeText(s)},title:"Compartir artículo",children:e.jsx(F,{size:16,className:"text-gray-400 hover:text-primary"})}),e.jsx("button",{className:"bg-dark-lighter hover:bg-dark rounded-full p-2 transition-colors",onClick:()=>{const s=window.location.href,d=`Lee este artículo: ${r.title}`;window.open(`https://twitter.com/intent/tweet?url=${encodeURIComponent(s)}&text=${encodeURIComponent(d)}`,"_blank")},title:"Compartir en Twitter",children:e.jsx("svg",{width:16,height:16,viewBox:"0 0 24 24",fill:"currentColor",className:"text-gray-400 hover:text-primary",children:e.jsx("path",{d:"M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"})})}),e.jsx("button",{className:"bg-dark-lighter hover:bg-dark rounded-full p-2 transition-colors",onClick:()=>{const s=window.location.href;window.open(`https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(s)}`,"_blank")},title:"Compartir en Facebook",children:e.jsx("svg",{width:16,height:16,viewBox:"0 0 24 24",fill:"currentColor",className:"text-gray-400 hover:text-primary",children:e.jsx("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})})})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(l,{to:`/blog?category=${r.category}`,className:"bg-dark-lighter hover:bg-dark px-3 py-1 rounded-lg text-sm transition-colors",children:r.category}),e.jsxs("span",{className:"text-gray-400 text-sm",children:["• ",Math.ceil(r.content.length/1e3)," min de lectura"]})]})]})]}),e.jsxs("div",{className:"bg-dark-light rounded-lg border border-gray-800 p-6",children:[e.jsxs("h3",{className:"font-bold text-lg mb-6",children:["Comentarios ",u.length>0&&`(${u.length})`]}),e.jsx("div",{className:"space-y-6",children:u.length>0?u.map(s=>e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"w-10 h-10 rounded-full overflow-hidden mr-3 flex-shrink-0",children:e.jsx("img",{src:s.authorAvatar,alt:s.author,className:"w-full h-full object-cover"})}),e.jsxs("div",{className:"flex-grow",children:[e.jsxs("div",{className:"bg-dark rounded-lg p-3",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("span",{className:"font-medium",children:s.author}),e.jsxs("span",{className:"text-xs text-gray-400",children:[new Date(s.date).toLocaleDateString("es-ES",{day:"2-digit",month:"short"}),new Date(s.date).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})!=="00:00"&&` a las ${new Date(s.date).toLocaleTimeString("es-ES",{hour:"2-digit",minute:"2-digit"})}`]})]}),e.jsx("p",{className:"text-sm text-gray-300",children:s.content})]}),e.jsxs("div",{className:"flex items-center mt-2 text-xs text-gray-400 space-x-4",children:[e.jsxs("button",{className:"hover:text-primary transition-colors flex items-center",onClick:()=>U(s.id),children:[e.jsx(Z,{size:12,className:"mr-1"}),s.likes>0?`${s.likes} ${s.likes===1,"me gusta"}`:"Me gusta"]}),e.jsx("button",{className:"hover:text-primary transition-colors",children:"Responder"})]})]})]},s.id)):e.jsxs("div",{className:"text-center py-8 text-gray-400",children:[e.jsx(P,{size:48,className:"mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No hay comentarios aún. ¡Sé el primero en comentar!"})]})}),e.jsxs("div",{className:"mt-8",children:[e.jsx("h4",{className:"font-medium mb-3",children:"Deja un comentario"}),p&&e.jsx("div",{className:`p-3 rounded-lg mb-4 text-sm ${p.includes("Error")?"bg-red-500/20 text-red-400":"bg-green-500/20 text-green-400"}`,children:p}),e.jsxs("form",{onSubmit:M,children:[e.jsx("textarea",{className:"input w-full min-h-[100px] mb-3",placeholder:"Escribe tu comentario aquí...",value:i,onChange:s=>x(s.target.value),disabled:c,required:!0}),e.jsx("button",{type:"submit",className:"btn-primary disabled:opacity-50 disabled:cursor-not-allowed",disabled:c||!i.trim(),children:c?"Enviando...":"Enviar comentario"})]})]})]})]}),e.jsxs("div",{children:[e.jsxs("div",{className:"bg-dark-light rounded-lg border border-gray-800 p-6 mb-6",children:[e.jsx("h3",{className:"font-bold mb-4",children:"Sobre el autor"}),e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full overflow-hidden mr-4",children:e.jsx("img",{src:`https://ui-avatars.com/api/?name=${r.author}&background=111827&color=fff&size=128`,alt:r.author,className:"w-full h-full object-cover"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-bold",children:r.author}),e.jsx("p",{className:"text-sm text-gray-400",children:"Editor en La Virtual Zone"})]})]}),e.jsx("p",{className:"text-sm text-gray-300 mb-4",children:"Escritor especializado en análisis táctico y cobertura de eventos de La Virtual Zone desde 2023."}),e.jsxs(l,{to:`/usuarios/${r.author.toLowerCase()}`,className:"text-primary hover:text-primary-light text-sm flex items-center",children:[e.jsx("span",{children:"Ver perfil"}),e.jsx(H,{size:14,className:"ml-1"})]})]}),I.length>0&&e.jsxs("div",{className:"bg-dark-light rounded-lg border border-gray-800 p-6 mb-6",children:[e.jsx("h3",{className:"font-bold mb-4",children:"Artículos relacionados"}),e.jsx("div",{className:"space-y-4",children:I.map(s=>e.jsxs(l,{to:`/blog/${s.slug}`,className:"flex items-start group",children:[e.jsx("div",{className:"w-20 h-20 rounded-lg overflow-hidden flex-shrink-0 mr-3",children:e.jsx("img",{src:s.image,alt:s.title,className:"w-full h-full object-cover"})}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium group-hover:text-primary transition-colors",children:s.title}),e.jsxs("div",{className:"flex items-center mt-1 text-xs text-gray-400",children:[e.jsx(z,{size:12,className:"mr-1"}),e.jsx("span",{children:new Date(s.date).toLocaleDateString("es-ES",{day:"2-digit",month:"2-digit",year:"2-digit"})})]})]})]},s.id))})]}),e.jsxs("div",{className:"bg-dark-light rounded-lg border border-gray-800 p-6",children:[e.jsx("h3",{className:"font-bold mb-4",children:"Categorías"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{to:"/blog?category=Noticias",className:"block p-2 rounded-lg hover:bg-dark transition-colors",children:"Noticias"}),e.jsx(l,{to:"/blog?category=Análisis",className:"block p-2 rounded-lg hover:bg-dark transition-colors",children:"Análisis"}),e.jsx(l,{to:"/blog?category=Fichajes",className:"block p-2 rounded-lg hover:bg-dark transition-colors",children:"Fichajes"}),e.jsx(l,{to:"/blog?category=Comunidad",className:"block p-2 rounded-lg hover:bg-dark transition-colors",children:"Comunidad"}),e.jsx(l,{to:"/blog?category=Humor",className:"block p-2 rounded-lg hover:bg-dark transition-colors",children:"Humor"})]})]})]})]})})]})};export{re as default};
